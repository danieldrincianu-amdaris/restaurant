# Story 1.1: Project Setup & Health Check

## Status: Ready for Review

## Story

**As a** developer,  
**I want** the project scaffolded with proper structure and tooling,  
**so that** I have a solid foundation for building features.

## Acceptance Criteria

1. Monorepo structure created with `packages/api`, `packages/web`, and `packages/shared` directories
2. TypeScript configured for all packages with strict mode enabled
3. ESLint and Prettier configured with consistent rules across packages
4. Package.json scripts for dev, build, lint, and test commands
5. Express API server runs on configurable port (default 3001)
6. Health check endpoint (`GET /api/health`) returns `{ status: "ok", timestamp: <ISO date> }`
7. Basic error handling middleware catches and formats errors as JSON
8. README with setup instructions (install, run, test)

## Tasks / Subtasks

- [x] **Task 1: Initialize Monorepo Structure** (AC: 1)
  - [x] Create root `package.json` with pnpm workspaces configuration
  - [x] Create `pnpm-workspace.yaml` defining packages/*
  - [x] Create directory structure: `packages/api`, `packages/web`, `packages/shared`
  - [x] Initialize each package with its own `package.json`
  - [x] Set package names: `@restaurant/api`, `@restaurant/web`, `@restaurant/shared`

- [x] **Task 2: Configure TypeScript** (AC: 2)
  - [x] Create root `tsconfig.base.json` with shared strict settings
  - [x] Create `packages/api/tsconfig.json` extending base
  - [x] Create `packages/web/tsconfig.json` extending base  
  - [x] Create `packages/shared/tsconfig.json` extending base
  - [x] Configure paths for shared package imports

- [x] **Task 3: Configure ESLint and Prettier** (AC: 3)
  - [x] Install eslint, prettier, and TypeScript ESLint plugins at root
  - [x] Create root `.eslintrc.js` with TypeScript rules
  - [x] Create root `.prettierrc` with consistent formatting
  - [x] Add `.eslintignore` for node_modules, dist, coverage

- [x] **Task 4: Configure Root Scripts** (AC: 4)
  - [x] Add `dev` script to run all packages in development
  - [x] Add `build` script to build all packages
  - [x] Add `lint` script to lint all packages
  - [x] Add `test` script to run all tests
  - [x] Add `typecheck` script for TypeScript validation

- [x] **Task 5: Setup Express API Server** (AC: 5, 6, 7)
  - [x] Install Express, cors, and TypeScript dependencies in api package
  - [x] Create `packages/api/src/index.ts` entry point
  - [x] Create `packages/api/src/app.ts` with Express app setup
  - [x] Create `packages/api/src/config/index.ts` for environment config (PORT default 3001)
  - [x] Create `packages/api/src/routes/index.ts` route aggregator
  - [x] Create `packages/api/src/routes/health.ts` with GET /api/health endpoint
  - [x] Create `packages/api/src/middleware/error-handler.ts` 
  - [x] Wire up error handler middleware

- [x] **Task 6: Create Shared Package Foundation** (AC: 1)
  - [x] Create `packages/shared/src/index.ts` barrel export
  - [x] Create `packages/shared/src/types/index.ts` for type exports
  - [x] Configure shared package to build as CommonJS + ESM

- [x] **Task 7: Create README** (AC: 8)
  - [x] Write README.md with project overview
  - [x] Document prerequisites (Node.js 20+, pnpm 8+)
  - [x] Document installation steps
  - [x] Document development commands
  - [x] Document project structure overview

- [x] **Task 8: Add Environment Configuration** (AC: 5)
  - [x] Create `.env.example` with PORT and other vars
  - [x] Add `.env` to `.gitignore`
  - [x] Document environment variables in README

- [x] **Task 9: Write Unit Tests for Health Endpoint** (AC: 6)
  - [x] Install Vitest and supertest in api package
  - [x] Create `packages/api/tests/health.test.ts`
  - [x] Test GET /api/health returns 200 with correct format
  - [x] Test response includes status "ok" and valid timestamp

## Dev Notes

### Project Structure Reference
[Source: architecture.md#Project Structure]

The monorepo uses pnpm workspaces with three packages:
```
restaurant-flow/
├── packages/
│   ├── api/                    # Backend application
│   │   ├── src/
│   │   │   ├── index.ts        # Entry point
│   │   │   ├── app.ts          # Express app setup
│   │   │   ├── config/         # Configuration
│   │   │   │   └── index.ts    # Environment config
│   │   │   ├── routes/         # REST API routes
│   │   │   │   ├── index.ts    # Route aggregator
│   │   │   │   └── health.ts
│   │   │   ├── middleware/     # Express middleware
│   │   │   │   └── error-handler.ts
│   │   │   └── utils/          
│   │   │       └── logger.ts
│   │   ├── tests/              # Backend tests
│   │   ├── package.json
│   │   └── tsconfig.json
│   ├── web/                    # Frontend application (scaffolded only)
│   │   ├── package.json
│   │   └── tsconfig.json
│   └── shared/                 # Shared types and utilities
│       ├── src/
│       │   ├── types/          
│       │   └── index.ts
│       ├── package.json
│       └── tsconfig.json
├── package.json                # Root workspace config
├── pnpm-workspace.yaml         # pnpm workspace config
├── tsconfig.base.json          # Base TS config
├── .eslintrc.js
├── .prettierrc
├── .env.example
└── README.md
```

### Tech Stack for This Story
[Source: architecture.md#Tech Stack]

| Technology | Version | Purpose |
|------------|---------|---------|
| TypeScript | 5.3+ | Type-safe development |
| Express | 4.18+ | HTTP server and routing |
| pnpm workspaces | 8.0+ | Package management |
| Vitest | 1.0+ | Unit testing |
| ESLint | Latest | Code linting |
| Prettier | Latest | Code formatting |

### Health Endpoint Specification
[Source: architecture.md#REST API Specification]

- **Endpoint:** `GET /api/health`
- **Response Format:**
```json
{
  "status": "ok",
  "timestamp": "2026-01-13T12:00:00.000Z"
}
```

### Error Handler Pattern
[Source: architecture.md#Backend Architecture]

```typescript
// packages/api/src/middleware/error-handler.ts
export function errorHandler(
  error: Error,
  req: Request,
  res: Response,
  next: NextFunction
) {
  console.error('Error:', error);
  
  res.status(500).json({
    error: {
      code: 'INTERNAL_ERROR',
      message: 'An unexpected error occurred',
    },
  });
}
```

### Express App Setup Pattern
[Source: architecture.md#Backend Architecture]

```typescript
// packages/api/src/app.ts
import express from 'express';
import cors from 'cors';
import { errorHandler } from './middleware/error-handler';

export function createApp() {
  const app = express();
  
  app.use(cors());
  app.use(express.json());
  
  // Routes
  app.use('/api', createRoutes());
  
  // Error handling (must be last)
  app.use(errorHandler);
  
  return app;
}
```

### Environment Configuration
[Source: architecture.md#Deployment Configuration]

```bash
# .env.example
PORT=3001
NODE_ENV=development
```

## Testing

### Testing Standards
[Source: architecture.md#Testing Strategy]

- **Framework:** Vitest 1.0+
- **Test Location:** `packages/api/tests/`
- **Integration Testing:** Use supertest for API endpoint tests

### Test Pattern for Health Endpoint

```typescript
// packages/api/tests/health.test.ts
import { describe, it, expect } from 'vitest';
import request from 'supertest';
import { createApp } from '../src/app';

describe('GET /api/health', () => {
  it('should return 200 with status ok', async () => {
    const app = createApp();
    const response = await request(app).get('/api/health');
    
    expect(response.status).toBe(200);
    expect(response.body.status).toBe('ok');
    expect(response.body.timestamp).toBeDefined();
  });
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-13 | 0.1 | Initial story draft | Bob (SM) |
| 2026-01-13 | 0.2 | Implementation complete | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5

### Debug Log References
No issues requiring debug log entries.

### Completion Notes List
- All 9 tasks completed successfully
- 4 unit tests passing for health endpoint
- Typecheck passes for all 3 packages
- Lint passes with only expected console warnings in server startup
- pnpm workspaces configured and working correctly
- Shared package builds to both CJS and ESM formats

### File List
**Created:**
- `package.json` - Root workspace configuration
- `pnpm-workspace.yaml` - pnpm workspace definition
- `tsconfig.base.json` - Shared TypeScript configuration
- `.eslintrc.js` - ESLint configuration
- `.eslintignore` - ESLint ignore patterns
- `.prettierrc` - Prettier configuration
- `.gitignore` - Git ignore patterns
- `.env.example` - Environment variable template
- `README.md` - Project documentation
- `packages/api/package.json` - API package configuration
- `packages/api/tsconfig.json` - API TypeScript configuration
- `packages/api/vitest.config.ts` - Vitest configuration
- `packages/api/src/index.ts` - Server entry point
- `packages/api/src/app.ts` - Express app setup
- `packages/api/src/config/index.ts` - Environment configuration
- `packages/api/src/routes/index.ts` - Route aggregator
- `packages/api/src/routes/health.ts` - Health check endpoint
- `packages/api/src/middleware/error-handler.ts` - Error handling middleware
- `packages/api/tests/health.test.ts` - Health endpoint tests
- `packages/web/package.json` - Web package configuration
- `packages/web/tsconfig.json` - Web TypeScript configuration
- `packages/web/src/index.ts` - Placeholder file
- `packages/shared/package.json` - Shared package configuration
- `packages/shared/tsconfig.json` - Shared TypeScript configuration
- `packages/shared/src/index.ts` - Barrel export
- `packages/shared/src/types/index.ts` - Shared type definitions
